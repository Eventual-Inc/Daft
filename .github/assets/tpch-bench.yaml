cluster_name: colin-cluster

provider:
  type: aws
  region: us-west-2
  cache_stopped_nodes: false

auth:
  ssh_user: ec2-user

max_workers: 4
available_node_types:
  ray.head.default:
    resources: {"CPU": 0}
    node_config:
      InstanceType: i8g.4xlarge
      ImageId: ami-0345469b8a1ca112a
      IamInstanceProfile:
        Name: ray-autoscaler-v1

  ray.worker.default:
    min_workers: 4
    max_workers: 4
    resources: {}
    node_config:
      InstanceType: i8g.4xlarge
      ImageId: ami-0345469b8a1ca112a
      IamInstanceProfile:
        Name: ray-autoscaler-v1

setup_commands:
# mount NVME to /tmp
- sudo blkid /dev/nvme1n1 || sudo mkfs.ext4 /dev/nvme1n1
- mount | grep -q '/dev/nvme1n1.*on /tmp' || (sudo umount /tmp 2>/dev/null || true; sudo mount -t ext4 /dev/nvme1n1 /tmp)
- sudo chmod 777 /tmp

# install UV and dependencies
- curl -LsSf https://astral.sh/uv/install.sh | sh
- test -d ~/.venv || uv venv --python 3.10
- grep -qF 'source ~/.venv/bin/activate' ~/.bashrc || echo "source ~/.venv/bin/activate" >> ~/.bashrc
- source ~/.venv/bin/activate
- uv pip install pip ray[default] --no-progress
- uv pip install ${DAFT_INDEX_URL}
