name: Check Broken Links on getdaft.io

on:
  schedule:
  - cron: '0 20 * * *'
  workflow_dispatch:

jobs:
  check-links:
    timeout-minutes: 45
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Check links with lychee
      uses: lycheeverse/lychee-action@v1.10.0
      with:
        args: |
          --verbose
          --no-progress
          'https://www.getdaft.io'

  # notify_on_failure:
  #   runs-on: ubuntu-latest
  #   if: failure()
  #   needs: check-links

  #   steps:
  #   - name: Send Slack notification on failure
  #     uses: slackapi/slack-github-action@v2.0.0
  #     with:
  #       payload: |
  #         {
  #           "blocks": [
  #             {
  #               "type": "section",
  #               "text": {
  #                 "type": "mrkdwn",
  #                 "text": ":rotating_light: [NIGHTLY] Broken Link Checker <${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|workflow> *FAILED* :rotating_light:"
  #               }
  #             }
  #           ]
  #         }
  #       webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
  #       webhook-type: incoming-webhook
