name: Nightly package build, S3 publish, and tests

on:
  push:

env:
  S3_BUCKET: s3://github-actions-artifacts-bucket/builds/nightly/
  AWS_REGION: us-west-2
  CLOUDFRONT_DIST_ID: E3H8WN738AJ1D4

  DAFT_ANALYTICS_ENABLED: '0'
  PYTHON_VERSION: '3.9'

jobs:
  benchmark-distributed-tpch:
    uses: ./.github/workflows/benchmark-distributed-tpch.yml
    with:
      daft_index_url: https://d1p3klp2t5517h.cloudfront.net/builds/nightly
      scale_factor: 1000
      num_workers: 4
    secrets: inherit
