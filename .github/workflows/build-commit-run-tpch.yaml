name: Build commit and run tpch benchmarks

on:
  workflow_dispatch:
    inputs:
      skip_questions:
        type: string
        description: The TPC-H questions to skip
        required: false
        default: ""
      scale_factor:
        type: choice
        options:
        - '2'
        - '10'
        - '100'
        - '1000'
        description: Which scale factor to use
        required: false
        default: '2'
      partition_size:
        type: choice
        options:
        - '2'
        - '32'
        - '100'
        - '300'
        - '320'
        - '512'
        description: Which partition size to use
        required: false
        default: '2'
      python_version:
        type: string
        description: The version of python to use
        required: false
        default: '3.9'

jobs:
  build:
    uses: ./.github/workflows/build-commit.yaml
    secrets:
      ACTIONS_AWS_ROLE_ARN: ${{ secrets.ACTIONS_AWS_ROLE_ARN }}

  run:
    needs: build
    uses: ./.github/workflows/run-tpch.yaml
    with:
      wheel: ${{ needs.build.outputs.wheel }}
      skip_questions: ${{ inputs.skip_questions }}
      scale_factor: ${{ inputs.scale_factor }}
      partition_size: ${{ inputs.partition_size }}
      python_version: ${{ inputs.python_version }}
