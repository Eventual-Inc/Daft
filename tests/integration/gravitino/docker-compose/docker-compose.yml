services:
  gravitino:
    image: apache/gravitino:1.0.1
    container_name: daft-gravitino
    ports:
    - "${GRAVITINO_PORT:-8090}:8090"
    environment:
      GRAVITINO_HTTP_PORT: 8090
    volumes:
    - ./gravitino-entrypoint.sh:/entrypoint.sh:ro
    entrypoint: ["/bin/bash", "/entrypoint.sh"]
    restart: unless-stopped

  mysql:
    image: mysql:8.0
    platform: linux/amd64
    container_name: daft-mysql
    ports:
    - "${MYSQL_PORT:-3306}:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_ROOT_HOST: '%'
    volumes:
    - mysql-data:/var/lib/mysql
    restart: unless-stopped
    command:
    - --default-authentication-plugin=mysql_native_password
    - --binlog-expire-logs-seconds=60
    - --character-set-server=utf8mb4
    - --collation-server=utf8mb4_unicode_ci

  minio:
    image: quay.io/minio/minio
    container_name: daft-gravitino-minio
    volumes:
    - minio-data:/data
    ports:
    - "${MINIO_PORT:-9000}:9000"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command:
    - server
    - /data
    restart: unless-stopped

volumes:
  mysql-data:
  minio-data:
