apiVersion: v1
kind: Pod
metadata:
  name: daftlet
spec:
  containers:
  - name: daftlet
    image: localhost:5000/daftlet:v1
    securityContext:
      privileged: true
    command:
      - /app/daftlet
    volumeMounts:
    - mountPath: /var/lib/containerd
      name: containerd-var-lib
    - mountPath: /run/containerd
      name: containerd-run
      subPath: containerd
    - mountPath: /run/eventual
      name: eventual-data-sockets
    ports:
    - containerPort: 8080
    env:
    - name: READER_IMAGE_URL
      value: 941892620273.dkr.ecr.us-west-2.amazonaws.com/daft/reader:0.0.1-dev7
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: aws
          key: AWS_ACCESS_KEY_ID
          optional: true 
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: aws
          key: AWS_SECRET_ACCESS_KEY
          optional: true 
  volumes:
  - name: containerd-var-lib
    hostPath:
      path: /var/lib/containerd
      type: Directory
  - name: containerd-run
    hostPath:
      path: /run
      type: Directory
  - name: eventual-data-sockets
    hostPath:
      path: /run/eventual
      type: DirectoryOrCreate
